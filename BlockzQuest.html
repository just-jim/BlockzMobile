<!DOCTYPE html>
<html >

<head>  
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="Blockz.me is a game site that has blocks!" />
	<meta name="author" content="Â© Blockz "/>
	<meta name="viewport" content="user-scalable=0"/>
	<title> BlockZ </title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/formStyle.css" />
	<link rel="stylesheet" type="text/css" href="css/login-box.css" />
	<link rel="stylesheet" type="text/css" href="css/backpack.css" />
	<link rel="stylesheet" type="text/css" href="css/dropMenu.css" />
	<!--<script type="text/javascript" src="Jquery/jquery.js"></script> -->
	<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
	<script src="http://code.jquery.com/ui/1.8.21/jquery-ui.min.js"></script>
	
	<script type="text/javascript" src="Jquery/jquery.scrollto.js"> </script>     
	<!--<script type="text/javascript" src="Jquery/jqueryUI.js"> </script>   -->
	
	<script type="text/javascript" src="Jquery/jquery.mobile.custom.min.js"> </script> 
	<script type="text/javascript" src="Jquery/jquery.ui.touch-punch.js"</script> 
</head>

<body >

<div id="menu">
	<img src="image/general/menubar.png" alt="">
</div> 

<div id="Grid" class="becenter">
	<table id="OuterMap">
	</table>
	
</div>

<div id="header" class="becenter webkit">
	<span>
		<span id="minititle">Blockz Quest</span>
		<span id="level"></span>
	</span>
</div>

<div class="userstats becenter webkit" style="pointer-events:none;">
	<span id="EnergyCount">
		<img src="image/treasure/icons/energy.png" width="30" height="30">
		<span>: 0</span>
	</span>
</div>

<div id="NavigationPad" style="position:fixed; bottom: 0; right: 0;">
	<table>
		<tr>
			<td class="highlightit" colspan="3"> 
				<img id="UpKey" src="image/navigation/up.png" style="width: 35px;">
			</td>
		</tr>
		<tr>
			<td class="highlightit">
				<img id="LeftKey" src="image/navigation/left.png" style="width: 35px;">
			</td>
			<td class="highlightit">
				<img id="DownKey" src="image/navigation/down.png" style="width: 35px;">
			</td>
			<td class="highlightit">
				<img id="RightKey" src="image/navigation/right.png" style="width: 35px;">
			</td>
		</tr>
	</table>
</div>
<!-- data-role="header" data-position="fixed" data-fullscreen="true" -->
<!--<div id="levelUpPopup" class="becenter popup webkit" data-role="header" data-position="fixed" data-fullscreen="true">
	<img id="levelUpPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p class="becenter" style="font-size:40px; font-family: Feast; top:15%;">Level Up !</p>
	<img class="becenter" src="image/treasure/forms/levelupArrow.png" alt="" style=" top:38%; height: 25%; ">
	<div id="levelUpBtn" class="becenter" style="z-index:101; bottom: 10%;">
		<img id="levelUp" src="image/treasure/forms/levelup-btn.png" alt="" style="margin-top:10px;">
	</div>	
</div>
-->

<div id="levelUpPopup" style="text-align:center; width:100%; background: url(image/general/login-box-backg.png) no-repeat center top; background-size: 100% 100%;" data-role="header" data-position="fixed" data-fullscreen="true">
	<h1 style="position:relative; z-index:200; padding-top:100px; margin:0 auto;">Fixed Header!</h1>
	<img style="position:relative; z-index:200; padding-top:100px; margin:0 auto;" id="levelUp" src="image/treasure/forms/levelup-btn.png" alt="" style="margin-top:10px;">
	<img id="levelUpPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
</div>


<div id="gameInfoPopup" class="becenter popup webkit">
	<img id="gameInfoPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p class="becenter" style="font-size:40px; font-family: Feast; top:15%;">Info</p>
	<img id="gameInfoImage" class="becenter" src="image/treasure/tools/pick.png" alt="" style="top:38% height: 25%; ">
	<p id="wordsGameInfo" class="becenter" style="font-size:20px; width:70%; top: 28%;">
	You got your first axe! Having an axe allows you to break stone! Maybe there is some obvious way to use that fact in this level.
	</p>
</div>


<div id="kingPopup" class="becenter popup webkit">
	<img id="kingPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p id="words" class="becenter" style="font-size:20px; width:70%; top: 20%;">
	You who witnessed my fallen kingdom... You shall see it rize again... 
	You must prove yourself. Show your powerful, assertive and - especially - 
	cunning side. Then we shall meet and i will name you king wormy, my rightful heir. 
	Take this axe and proceed
	</p>
</div>

<div id="orderPopup" class="becenter popup webkit">
	<img id="orderPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p id="wordsOrd" style="font-size:20px;">Shout what you want</p>
	<input type="text" name="commandy" id="order"></input>
	<input type="button" name="button" value="Shout!" onClick="doOrder()"> </input>
</div>

<div id="albPopup" class="becenter popup webkit">
	<img id="albPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p id="wordsAlb" style="font-size:20px; width:70%; top: 20%;">
		Who? Who are you? You look like that insensitive bastard Robert! 
		He said funny things about my hat!
	</p>
</div>

<div id="broPopup" class="becenter popup webkit">
	<img id="broPopupExit" class="exitbtn" src="image/general/exit.png" alt="">
	<p id="wordsBro" style="font-size:20px; width:70%; top: 20%;">
		O-O-omg!??! Are you my brother? 
		Yes, yes you are! At last i found you! 
		Listen i am in a fight with my friend Albert :(. 
		Can you help? Here have this hammer!
	</p>
</div>

<div style="position:fixed; top: 0; left: 0; z-index: 3;">
	<div class="Navigation webkit">
		<div id="NavigationInside">
			<ul>
				<li ><a href="#"><img src="image/general/menuButton.png" height="40px;" alt=""></a>
					<ul class="horizontal">
							<div class="extended">
								<div class="arrow-up"></div>
								<ul class="smallNav">
									<li>
										<a href><img class="imgshortcut" src="image/general/repeat.png" alt=""></a>
									</li>
									<li>
										<a href="levels.html"><img class="imgshortcut" src="image/Worlds/World_2.png" alt=""></a>
									</li>
									<li>
										<a href="index.html"><img class="imgshortcut" src="image/Worlds/Menu.png" alt=""></a>
									</li>
								</ul>
							</div>
					</ul>
				</li>
			</ul>
		</div>
	</div>
</div>

<div style="position:fixed; bottom: 0; left: 0; margin-bottom: -25px;">
	<table>
		<tr>
			<td>
				<div class="backpack webkit">
					<div id="backpackInside">
						<ul>
							<li><a href="#"><img src="image/treasure/tools/backpack.png" height="50px;" alt=""></a>
								<ul class="horizontal">
									<div class="extended">
										<div class="arrow-down"></div>
										<ul class="smallNav">
											<li id="backpackEmpty">
												<a>Empty!</a>
											</li>
										</ul>
									</div>
								</ul>
							</li>
						</ul>
					</div>
				</div>
			</td>
			<td>
				<div>
					<img  id="minimap" class="hand" src="image/BQ/Treasure map.png"  style="height:70px;"/>
				</div>
			</td>
		</tr>
	</table>
</div>
	

<!--
<div style="position:fixed; bottom: 0; right: 40%; padding-right: 10px;margin-bottom: -10px;">
	<img  id="minimap" class="hand" src="image/BQ/Treasure map.png"  style="height:70px;"/>
</div>
-->
<audio id="pickaxeClip"><source src="audio/axe.mp3"></source> </audio>
<audio id="punchClip"><source src="audio/punch.mp3"></source> </audio>
<audio id="albertClip"><source src="audio/albert.mp3"></source> </audio>
<audio id="mirrorClip"><source src="audio/mirror.mp3"></source> </audio>
<audio id="levelupClip"><source src="audio/levelup.mp3"></source></audio>
<audio id="popClip"><source src="audio/pop.mp3"></source></audio>
<audio id="chestClip"><source src="audio/chest.mp3"></source></audio>
<audio id="keyClip"><source src="audio/key.mp3"></source></audio>
<audio id="waterClip"><source src="audio/water.mp3"></source></audio>
<audio id="unlockClip"><source src="audio/unlock.mp3"></source></audio>
<audio id="ambulanceClip"><source src="audio/ambulance.mp3"></source> </audio>
<audio id="antilavaClip"><source src="audio/antilava.mp3"></source> </audio>

<script type="text/javascript">

var chrome = 0; var firefox = 1;

// Pinakes eikonwn
//index3:	0: unexplored	1: explore  	2: explored     3:downLimitTile     4:UpLimitTile
images=["image/tile.png","image/treasure/elements/explore.png","image/treasure/elements/empty.png","image/treasure/elements/DownLimit.jpg","image/treasure/elements/UpLimit.jpg"];

clicks=['ajax/clickTreasure.php','ajax/clickTreasureKey.php','ajax/clickTreasureChest.php','ajax/clickTreasureWall.php',
		'ajax/levelUp.php','ajax/clickTreasureLava.php','ajax/clickTreasureWater.php'];

//index2:	0: loading 	1: openedChest	2:avatar	 3: chest		4: key  	5: wall		6: water	7:lava   8: door  9:jesus  10:BigChest 11:openedBigChest 12:king? 13:pick 14:hole 15:gold 16: boat 17: brother 18: albert 19: blueflower 20: redflower 21:mirror left 22:mirror right 23: robertflip
	//		24: badworm  25:  robertdead 26: albertleft 27:badwormright 28:ambulance 29:bridge 30:antilava
samples=["image/general/loading.gif","image/treasure/elements/openedChest.png","image/treasure/character/man.png","image/treasure/elements/chest.png",
		"image/treasure/elements/key.png","image/treasure/elements/rockTile.jpg","image/treasure/elements/water.jpg",
		"image/treasure/elements/lava.jpg","image/treasure/elements/door.png","image/treasure/character/jesus.png","image/treasure/elements/BigChest.png",
		"image/treasure/elements/openedBigChest.png","image/treasure/character/king.png","image/treasure/tools/pick.png","image/general/hole.png","image/general/gold.png","image/treasure/tools/boat.png","image/treasure/character/brother.png","image/treasure/character/albert.png","image/general/blueflower.png",
		"image/general/redflower.png","image/general/mirror.png","image/general/mirror2.png","image/BQ/character/robert2.png","image/BQ/character/badworm.png","image/BQ/character/robertdead.png","image/BQ/character/albertleft.png","image/BQ/character/badwormright.png",
		"image/BQ/character/ambulance.png","image/general/bridge.jpg","image/treasure/tools/antilava.png"];

//index:	
mains=["image/treasure/backgrounds/test1.jpg","image/treasure/backgrounds/test2.jpg","image/treasure/backgrounds/test3.png",
		"image/treasure/backgrounds/test4.jpg","image/treasure/backgrounds/test5.jpg","image/treasure/backgrounds/test6.png",
		"image/treasure/backgrounds/test7.gif","image/treasure/backgrounds/test8.jpg","image/treasure/elements/water.jpg"];	

// Tools:  0: pick		2: boat		3: antilava
tools=["image/treasure/tools/pick.png","image/treasure/tools/boat.png","image/treasure/tools/antilava.png"];
		

		
// pinakas hxwn
sounds=[$("#antilavaClip")[0],$("#ambulanceClip")[0],$("#mirrorClip")[0],$("#albertClip")[0],$("#punchClip")[0],$("#pickaxeClip")[0],$("#levelupClip")[0],$("#popClip")[0],$("#chestClip")[0],$("#keyClip")[0],$("#waterClip")[0],$("#unlockClip")[0]];

// Bottom Offset (appearance of grid)
bottomOffset = 50;

// Map dimentions
n = 19; nv = 12;

// Initialize GLOBAL vars.
keys = 0;
energy = 0;
hammer = 0;
boat = 0 ;
antilava = 0;
IamAlbert=0;
boatFlag = 0;
lastMoveX = 0;
lastMoveY = 0;
playerGone = 0;
holeGone =0;
helped=0;
flower=0;
titlecount=0;
titlesbrowsed=0;
badWormEnergy=3;
minimapVisible = false;

$('#levelUpPopup').fixedtoolbar();
$('#levelUpPopup').fixedtoolbar('hide');

pos = new Object();
pos["albert"] = [6,6,samples[18]];
pos["robert"] = [6,5,samples[23]];
pos["bad"] = [11,5,samples[24]];
pos["ambulance"] = [18,5,samples[28]];

//How many times talked

albcount=0;
brocount=0;

//Allow player to move flag
moveAlow = 1;

//Is player flipped?
playerflipped=0;

// Initialize sound mute
mute = false;

title="";
energy = 0;
level =getURLParameter("lvl");

file = "BQLevels/"+level+".txt";
$.get(file, function(data)
{
	parts = data.split("#");
	energy = parts[3];
	title = parts[2];
	prepareMap(parts[0],parts[1]);
});
	

function touchHandler(event) {
    var touch = event.changedTouches[0];

    var simulatedEvent = document.createEvent("MouseEvent");
        simulatedEvent.initMouseEvent({
        touchstart: "mousedown",
        touchmove: "mousemove",
        touchend: "mouseup"
    }[event.type], true, true, window, 1,
        touch.screenX, touch.screenY,
        touch.clientX, touch.clientY, false,
        false, false, false, 0, null);

    touch.target.dispatchEvent(simulatedEvent);
    event.preventDefault();
}

function init() {
    document.addEventListener("touchstart", touchHandler, true);
    document.addEventListener("touchmove", touchHandler, true);
    document.addEventListener("touchend", touchHandler, true);
    document.addEventListener("touchcancel", touchHandler, true);
}
	
function getURLParameter(name){
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}

document.ready(function() {
	
	init();
	
});

	
$(window).load(function() {	
	
	if(level==7) {
		$('#wordsGameInfo').html('"Oh no! A weird golden block is blocking my way"... Do not panic! Golden blocks disappear when certain conditions are met!');
		$('#gameInfoImage').attr('src',samples[15]);
		gameInfoPopup();
	}
	
	playMovie();
	
	if(level==14) {
		$('#Map tr:eq(10) td:eq(18) img').draggable({revert:true});
		$( "#Map tr:eq(5) td:eq(9)" ).droppable({
	      	drop: function( event, ui ) {
		    	$( this ).css("background","url("+samples[29]+")");
		    	$( this ).css("background-size","100% 100%");
		    	$( this ).children().attr("src",images[2]);
		    	$('#Map tr:eq(10) td:eq(18) img').fadeOut("fast");
	      	}
   		});
	}
});


// Function to prepare map for the user 
function prepareMap(personal,background)
{
	user=1;		
	$('#level').html(' - Lvl: '+ level);
	
	$('#minititle').html(''+ title);
	
	$('#EnergyCount span').html(': '+ energy);
	
	// Dimiourgia tou map tou xristi (19x12)
	createArray(nv, n);
	
	// Topothetisi backrounds se oli ti pista
	backs = background.split(",");
	$.each(backs, function(index, value) {
	  if 	 (index % 3 == 0) tmpx = value;
	  else if(index % 3 == 1) tmpy = value;
	  else if(index % 3 == 2) changeBackround(tmpx,tmpy,value);
	});
	
	// Topothetisi twn elements (walls, keys, chest, ktl..) sto map
	elements = personal.split(",");
	$.each(elements, function(index, value) {
	  if 	 (index % 3 == 0) tmpx = value;
	  else if(index % 3 == 1) tmpy = value;
	  else if(index % 3 == 2) 
	  	{
	  		changeBlock(tmpx,tmpy,value);
	  		if (value == 2)
	  		{
	  			manx = tmpx;
				many = tmpy;
				lastMoveX=tmpx;
				lastMoveY=tmpy;
				$('html, body').animate({scrollLeft: $("#Map tr:eq("+many+") td:eq("+manx+")").offset().left});
				$('html, body').animate({scrollTop: $("#Map tr:eq("+many+") td:eq("+manx+")").offset().top});
	  		}
	  	}
	});
} 

// functions to show tools

function showTool(src,value,name)
{
	if (name != "boat")	$('#backpackInside ul li ul ul').append('<li id="list'+name+'"><img class="imgshortcut" src="'+tools[src]+'" alt=""><a id="'+name+'">x '+value+'</a></li>');
	else if(boatFlag == 1) $('#backpackInside ul li ul ul').append('<li id="list'+name+'"><img class="imgshortcut" src="'+tools[src]+'" alt=""></li>');
}

function manageTools(src,value,name)
{
	if(hammer + antilava + boatFlag != 0 )	 	$('#backpackInside ul li ul ul').html("");
	if(hammer!=0) 					showTool(0,hammer,"hammer");
	if(antilava!=0)		 			showTool(2,antilava,"antilava");
	if(boatFlag!=0)					showTool(1,0,"boat");
	$("li img").css("cursor","pointer");
	
}

// Dimiourgia  pinaka
function createArray(n, nv){
	
	var winW = $(window).width()*3;
	var winH = $(window).height()*3;
	
	height = Math.floor(winH / nv);
	width = height;
	
	
	// Create Outer Map
	$('#OuterMap').append('<tr>');
	for(i=0; i<nv; i++)
	{
		$('#OuterMap tr').last().append('<td><img src="'+ images[4]  +'" alt="" width="'+width+'" height="'+height+'"></td>');
	}
	$('#OuterMap').append('</tr>');
	
	$('#OuterMap').append('<tr>');
	$('#OuterMap tr').last().append('<td colspan="'+nv+'"><table id="Map" ></table></td>');
	$('#OuterMap').append('</tr>');
	
	$('#OuterMap').append('<tr>');
	for(i=0; i<nv; i++)
	{
		$('#OuterMap tr').last().append('<td><img src="'+ images[3]  +'" alt="" width="'+width+'" height="'+height+'"></td>');
	}
	$('#OuterMap').append('</tr>');
	
	
	// Create Inner Map
	el='<td><img src="'+ images[2]  +'" alt="" width="'+width+'" height="'+height+'"></td>';
	
	$('#Map').html("");
	for(j=0;j<n;j++)
	{
		$('#Map').append('<tr>');
		if(typeof nv == 'undefined') {nv = (Math.floor(0.8*($(window).width())/(height)));}
	    for (i=0;i<nv;i++){
	    	$('#Map tr').last().append(el);
	    	$('#Map tr').last().children().last().css("background","url("+mains[0]+")");
	    	$('#Map tr').last().children().last().css("backgroundSize","100% 100%");
	    }
	    $('#Map').append('</tr>');
	}
	
	// Player keyboard control
	
	$(document).keydown(function(e){ KeyMove(e.keyCode);});
	
	document.getElementById('UpKey').addEventListener('touchstart', function(e) {KeyMove(38);});
	document.getElementById('LeftKey').addEventListener('touchstart', function(e) {KeyMove(37);});
	document.getElementById('DownKey').addEventListener('touchstart', function(e) {KeyMove(40);});
	document.getElementById('RightKey').addEventListener('touchstart', function(e) {KeyMove(39);});
	
	function KeyMove(key)
	{
		//37 - left  38 - up  39 - right  40 - down
		if (moveAlow&&energy>0&&!playerGone)
		{
			if 	(key == 37) {
				lesource= $('#Map tr:eq('+ many +') td:eq('+ (manx-1) +')').children().attr("src");
				if((playerflipped)&&(lesource==samples[22])){
					music('mirror');
					playerflipped=0;
					$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/man.png");
					samples[2]="image/treasure/character/man.png";
				}
				playerMove(manx,many,(manx-1),many);
			}	   	// left arrow
			else if (key == 65) {
				lesource= $('#Map tr:eq('+ many +') td:eq('+ (manx-1) +')').children().attr("src");
				if((playerflipped)&&(lesource==samples[22])){
					music('mirror');
					playerflipped=0;
					$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/man.png");
					samples[2]="image/treasure/character/man.png";
				}
				playerMove(manx,many,(manx-1),many);  
			}	// key : a
			else if (key == 38) 
				playerMove(manx,many,manx,(many-1));   	// up arrow
			else if (key == 87) 
				playerMove(manx,many,manx,(many-1));   	// key : w
			else if (key == 39) { 
				lesource= $('#Map tr:eq('+ many +') td:eq('+ (manx-(-1)) +')').children().attr("src");
				if((!playerflipped)&&(lesource==samples[21])){
					music('mirror');
					playerflipped=1;
					$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/manflipped.png");
					samples[2]="image/treasure/character/manflipped.png";
				}
				playerMove(manx,many,(manx-(-1)),many);		
			}// right arrow
			else if (key == 68) {
				lesource= $('#Map tr:eq('+ many +') td:eq('+ (manx-(-1)) +')').children().attr("src");
				if((!playerflipped)&&(lesource==samples[21])){
					music('mirror');
					playerflipped=1;
					$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/manflipped.png");
					samples[2]="image/treasure/character/manflipped.png";
				}	
				playerMove(manx,many,(manx-(-1)),many);
			}	// key : d
			else if (key == 40) playerMove(manx,many,manx,(many-(-1)));	// down arrow
			else if (key == 83) playerMove(manx,many,manx,(many-(-1)));	// key : s
		}
	};
	
	$(document).keyup(function(e){
		//37 - left  38 - up  39 - right  40 - down
		var key = e.keyCode;
		if (moveAlow)
		{
			if 		(key == 37) playerExplore(manx,many,(manx-1),many);   	// left arrow
			else if (key == 65) playerExplore(manx,many,(manx-1),many);   	// key : a
			else if (key == 38) playerExplore(manx,many,manx,(many-1));   	// up arrow
			else if (key == 87) playerExplore(manx,many,manx,(many-1));   	// key : w
			else if (key == 39) playerExplore(manx,many,(manx-(-1)),many);	// right arrow
			else if (key == 68) playerExplore(manx,many,(manx-(-1)),many);	// key : d
			else if (key == 40) playerExplore(manx,many,manx,(many-(-1)));	// down arrow
			else if (key == 83) playerExplore(manx,many,manx,(many-(-1)));	// key : s	
		}
		if (key == 13) enterManager();								// enter
	});
	
	function playerMove(curx,cury,wanax,wanay)
	{
		lastMoveX=curx;
		lastMoveY=cury;
		var hitBlock =  $('#Map tr:eq('+ (wanay) +') td:eq('+ wanax +')').children();
		var block = hitBlock.attr("src");
		if (level==12&&wanax<0) {orderPopup();}
		if (level==12&&wanax>18&&helped) {levelUpPopup();}
			if(holeGone==1) {
				holeGone=0;
				$('#Map tr:eq('+cury+') td:eq('+curx+')').children().attr("src",samples[14]);
			}
		if( block == images[2] || block == samples[4]||block == samples[13]||block==samples[16]||block==samples[30])
		{
			energy--;
			$('#EnergyCount span').html(': '+ energy);
			var prewater = $('#Map tr:eq('+cury+') td:eq('+curx+')').children().attr("src");
			$('#Map tr:eq('+wanay+') td:eq('+wanax+')').children().attr("src",samples[2]);
			if (prewater == samples[9]) $('#Map tr:eq('+cury+') td:eq('+curx+')').children().attr("src",samples[6]);
			else if (prewater == samples[2]) $('#Map tr:eq('+cury+') td:eq('+curx+')').children().attr("src",images[2]);

			manx = wanax; 
			many = wanay;
		}
		// collectibles block
		if (block == samples[4]||block == samples[13]||block ==samples[16]||block==samples[30])	
		{
			music("key");
		//if key
			if(block==samples[4])	{
				keys++;
				$('#keyCount span').html('x '+ keys);
			}
		//if hammer	
			if(block==samples[13])	{
				hammer++;
				$('#hammer').html('x '+ hammer);
				if(hammer==1) {manageTools(0,1,"hammer");}
			}
						
		//if antilava	
			if(block==samples[30])	{
				antilava++;
				$('#antilava').html('x '+ antilava);
				if(antilava==1) {manageTools(2,1,"antilava");}
			}
		//if boat				
			if(block==samples[16])	{
				boatFlag=1;
				manageTools(1,0,"boat");
			}
		}
		else if (block == samples[8])  				// door block
		{
			levelUpPopup(wanax,wanay);
		}
		else if (block == samples[6])				// water block
		{
			if(boatFlag ==1 && energy > 0 && !IamAlbert) {
				//energy--;
				$('#EnergyCount span').html(': '+ energy);	
				walkOnWater(wanax,wanay); 
			}
		}
		else if (block==samples[14]){
			$('#Map tr:eq('+cury+') td:eq('+curx+')').children().attr("src",images[2]);
			playerGone=1;
			//level 9 special functionallity
			if(level==9){
				thatel=$('#Map tr:eq(4) td:eq(1)').children();
				setTimeout(function(){
					if(playerGone)thatel.fadeOut("slow",function(){
						thatel.attr("src",images[2]);  
						thatel.fadeIn("fast");
					});
				},20000);
	    	}
		}
	}
	
	function playerExplore(curx,cury,wanax,wanay)
	{
		if (manx == lastMoveX && many == lastMoveY)
		{
			var hitBlock =  $('#Map tr:eq('+ (wanay) +') td:eq('+ wanax +')').children();
			var block = hitBlock.attr("src"); 

			if ((block == images[1]) && (energy>0))  // explore block
			{
				music("explore");
			}	
			else if ( block == samples[3])			// chest
			{
				if (keys > 0) unlockPopup(wanax,wanay);
			}
			else if ( block == samples[10])
			{
				if (keys > 0) {CouponPopup(); music("unlock");} 
			}
		}
	}
	
	
	// Diaxeirisi CLICK panw se ena Block
	
	$('#Map img').each( function(i,el) {$(el).bind('click',function(e) {clicker(this);});});
	
	function clicker (thattel) {
		var thatel = $(thattel);
		x=thattel.parentNode.cellIndex;
		y=thattel.parentNode.parentNode.rowIndex;
		block=$(thattel).attr( "src" );
		//Kinisi Avatar me Click
		
		//Is the player on the map?
		if(!playerGone) {
		
		//Mirror interaction
		if(($(thattel).attr( "src" )== samples[21])&&playerIsNear(x,y)) {
					music('mirror');
					playerflipped=1;
					$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/manflipped.png");
					samples[2]="image/treasure/character/manflipped.png";
		}
		else if(($(thattel).attr( "src" )== samples[22])&&playerIsNear(x,y)) {
				music('mirror');
				playerflipped=0;
				$('#Map tr:eq('+ many +') td:eq('+ manx +')').children().attr("src","image/treasure/character/man.png");
				samples[2]="image/treasure/character/man.png";
			
		}
		
		//Basic movement - all sources on which you are allowed to move
		else if(($(thattel).attr( "src" )== images[2]||block == samples[4]||block == samples[13]||block ==samples[16]||block==samples[30])&&energy>0) {
		
			if(holeGone==1) {
				holeGone=0;
				$('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",samples[14]);
			}
			if(playerIsNear(x,y)) {
				if($('#minititle').html()!="So close yet so far")	energy--;
				$('#EnergyCount span').html(': '+ energy);	
				var prewater = $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src");
				$('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src",samples[2]);
				if (prewater == samples[9]) $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",samples[6]);
				else if (prewater == samples[2]) $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",images[2]);
				manx=x;
				many=y;
				//Basic Collectibles
		    	if (block == samples[4]||block == samples[13]||block ==samples[16]||block==samples[30])				
				{
					music("key");
					//if key
					if(block==samples[4])	{					
						keys++;
						$('#keyCount span').html('x '+ keys);
					}
					//if hammer	
					if(block==samples[13])	{					
						hammer++;
						$('#hammer').html('x '+ hammer);
						if(hammer==1) {manageTools(0,1,"hammer");}
					}
					
					//if antilava	
					if(block==samples[30])	{					
						antilava++;
						$('#antilava').html('x '+ antilava);
						if(antilava==1) {manageTools(2,1,"antilava");}
					}
					//if boat				
					if(block==samples[16])	{
						boatFlag=1;
						manageTools(1,0,"boat");			
					}
				}
			}
		}
		//Entering hole
		else if (block==samples[14]&&playerGone==0&&playerIsNear(x,y)){
			$('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",images[2]);
			playerGone=1;
			//level 9 special functionallity
			if(level==9){					
				thatel=$('#Map tr:eq(4) td:eq(1)').children();
				setTimeout(function(){if(playerGone)thatel.fadeOut("slow",function(){
	    		   	thatel.attr("src",images[2]);
	    		   	thatel.fadeIn("fast");
	    		});},12000);
	    	}
		}
		//POPUPS
	    else if($(thattel).attr( "src" )== samples[12] && playerIsNear(x,y))  // King speaks
	    {
	    	kingPopup();
	    }
	     else if($(thattel).attr( "src" )== samples[17] && playerIsNear(x,y))  // Bro speaks
	    {
	    	broPopup();
	    }
	    else if(($(thattel).attr( "src" )== samples[18]||$(thattel).attr( "src" )== samples[26]) && playerIsNear(x,y))  // Albert speaks
	    {
	    	albPopup();
	    }
	    else if(($(thattel).attr( "src" )== samples[24]||$(thattel).attr( "src" )== samples[27]) && playerIsNear(x,y))  // Bad Worm speaks
	    {
	    	orderPopup();
	    }
	    
	    else if($(thattel).attr( "src" )== samples[5] && playerIsNear(x,y))  // break-stone
	    {
			if (hammer > 0){
				Click(thatel,thattel,clicks[3]); 
				music("axe");
			
				if(level==7){
		    		var goodsmiley=true;
		    		for (y=0;y<=1;y++){
			    		for(x=4;x<=12;x++){
			    			if($('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src")==samples[5]) goodsmiley=false;
			    		}
		    		 }
		    		 for (y=3;y<=4;y++){
		    			for(x=4;x<=12;x++){
		    				if($('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src")==samples[5]) goodsmiley=false;
		    			}
		    		 }
	
					if($('#Map tr:eq('+2+') td:eq('+4+')').children().attr("src")==samples[5]||$('#Map tr:eq('+2+') td:eq('+12+')').children().attr("src")==samples[5]) goodsmiley=false;
					if($('#Map tr:eq('+2+') td:eq('+7+')').children().attr("src")!=samples[5]||$('#Map tr:eq('+2+') td:eq('+9+')').children().attr("src")!=samples[5]) goodsmiley=false;
				    if($('#Map tr:eq('+5+') td:eq('+5+')').children().attr("src")==samples[5]||$('#Map tr:eq('+5+') td:eq('+11+')').children().attr("src")==samples[5]) goodsmiley=false;
					if($('#Map tr:eq('+5+') td:eq('+6+')').children().attr("src")!=samples[5]||$('#Map tr:eq('+5+') td:eq('+10+')').children().attr("src")!=samples[5]) goodsmiley=false;
			   		if($('#Map tr:eq('+6+') td:eq('+7+')').children().attr("src")!=samples[5]||$('#Map tr:eq('+6+') td:eq('+8+')').children().attr("src")!=samples[5]||$('#Map tr:eq('+6+') td:eq('+9+')').children().attr("src")!=samples[5]) goodsmiley=false;	 
		    		if(goodsmiley) thatel.fadeOut("slow",function(){
		    		   	$('#Map tr:eq(1) td:eq(18)').children().attr("src",images[2]);
		    		   	$('#Map tr:eq(1) td:eq(18)').children().fadeIn("fast");
		    		});
		    	}
			}
	    }
	    else if($(thattel).attr( "src" )== samples[20] && playerIsNear(x,y))  // red flower
	    {
			$(thattel).attr("src",images[2]); flower=1;
	    }
	    else if($(thattel).attr( "src" )== samples[7] && playerIsNear(x,y))  // anti-lava
	    {
	    	music("antilava");
			if (antilava > 0){Click(thatel,thattel,clicks[5]);}
	    }
	    else if($(thattel).attr( "src" )== samples[3] && playerIsNear(x,y))  //chest
	    {
	    	if (keys > 0) {Click(thatel,thattel,clicks[2]); music("unlock");} 
	    }
	    else if ($(thattel).attr( "src" )== samples[8] && playerIsNear(x,y)) // door
	    {
	    	levelUpPopup(x,y);
	    }
	    else if ($(thattel).attr( "src" )== samples[6] && playerIsNear(x,y)) // water
	    {
			if(boatFlag ==1) walkOnWater(x,y); 
	    }
	    else if ($(thattel).attr( "src" )== samples[10] && playerIsNear(x,y))  //BigChest
	    {
	    	if (keys > 0) {CouponPopup(); music("unlock");} 
	    }
	    
	    else if ((level==13) &&($(thattel).attr( "src" )== samples[26])&&(!playerGone)) {
	    	manx=x;
	    	many=y;
	    	samples[2] = samples[26];
	    	IamAlbert=1;
	    }
	    else if ((level==13) &&($(thattel).attr( "src" )== "image/treasure/character/man.png")&&(!playerGone)) {
	    	manx=x;
	    	many=y;
	    	samples[2] = "image/treasure/character/man.png";
	    	IamAlbert=0;
	    }
	   }
	   //If the player is Gone from the Map he can only press on a hole
	    else if ($(thattel).attr( "src" )== samples[14]&&playerGone==1) // hole
	    {
	    	playerGone=0;
	    	holeGone=1;
	    	$('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src",samples[2]);
	    	manx=x;
			many=y;
	    }
	 }
	
	//Manage the situation when player is on water
	    
    function walkOnWater(wanax,wanay)
    {
    	if(energy>0) {
    		var prewater = $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src");
			$('#Map tr:eq('+wanay+') td:eq('+wanax+')').children().attr("src",samples[9]);
			if (prewater == samples[9]) $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",samples[6]);
			else if (prewater == samples[2])
			{
				 $('#Map tr:eq('+many+') td:eq('+manx+')').children().attr("src",images[2]);
				 music("water");
			}
			manx = wanax; 
			many = wanay;  	
			energy--;
			$('#EnergyCount span').html(': '+ energy);
			}
    }

    // Manage the ajax request that should be send each time
    function Click(that,thatt,what)
    {
		if (what== clicks[0] || what == clicks[3] || what == clicks[5])
		{
			if (what == clicks[0])
			{
				energy--;
				$('#EnergyCount span').html(': '+ energy);	
			}
			else if (what == clicks[3])
			{
				if(level==11){
	    		   	if((thatt.parentNode.parentNode.rowIndex==4)&&(thatt.parentNode.cellIndex==0)) {
	    		   		that.attr("src",samples[13]);
		    		   	hammer--;
						$('#hammer').html('x '+ hammer);
						neatBackpack();
		    		 }
	    		   	else{
	    		   		that.attr("src",images[2]);
						hammer--;
						$('#hammer').html('x '+ hammer);
						neatBackpack();
	    		   	}
    		   	}  
    		   	else{
					that.attr("src",images[2]);
					hammer--;
					$('#hammer').html('x '+ hammer);
					neatBackpack();
				}
			}
			else if (what == clicks[5])
			{
				that.attr("src",images[2]);
				antilava--;
				$('#antilava').html('x '+ antilava);
				neatBackpack();
			}	
		}	
    }
	
	// Elenxos an o paiktis einai dipla se kapoio block
	
	function playerIsNear(tmpx,tmpy)
	{
		if(((tmpx==manx)&&(Math.abs(tmpy-many)==1))||((tmpy==many)&&(Math.abs(tmpx-manx)==1))) return(true);
		else return(false);
	}

	function neatBackpack()
	{
		if (hammer 	== 	0) $('#listhammer').remove();
		if (boatFlag==	0) $('#boat').remove();
		if (antilava==	0) $('#antilava').remove();
		if (hammer+boatFlag+antilava == 0)	$('#backpackInside ul li ul ul').append('<a style="">Empty!</a>');
	}
	
	// Diaxeirisi tou click se door gia leveup
	
	function levelUpPopup(x,y)
	{
		moveAlow = 0;
		$("[data-position='fixed']").fixedtoolbar('show');
		document.getElementById('levelUpPopup').style.display = 'block';
		levelupx = x;
		levelupy = y;
	}
	
	document.getElementById('levelUp').addEventListener('touchstart', function(e){levelup();});
	
	function levelup()
	{
		if(level==15) document.location.href= 'youAreTheChampion.php';
		else{
		document.getElementById('levelUp').style.display = "none";
		music("levelup");
		level++;
		if (level>localStorage.getItem('level')) {
		level=level+'';
		localStorage.setItem('level',level);
		window.location.href = "BlockzQuest.html?lvl="+level;
		}
		else window.location.href = "levels.html";

		}
	}
		
	document.getElementById('levelUpPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("levelUpPopup").style.display = 'none';
		$("[data-position='fixed']").fixedtoolbar('hide');
	});
	
	function kingPopup()
	{
		moveAlow = 0;
		if($('#minititle').html()=="When suddenly..."){
		document.getElementById('kingPopup').style.display = 'block';
		hammer++;
		$('#hammer').html('x '+ hammer);
		if(hammer==1) {manageTools(0,1,"hammer");}
		}
		if($('#minititle').html()=="So close yet so far") {
			$   ('#words').html('Success is achieved slowly, step by step');
			document.getElementById('kingPopup').style.display = 'block';
		}
		if(level==9) {
			$   ('#words').html('Ah! Edgar Allan Poe! My favourite part of his work is The Raven verse 5! I really adore his symbolism!');
			document.getElementById('kingPopup').style.display = 'block';
		}
		if(level==11){
			$('#words').html('lalala when you walk through the garden, you better watch your back lalala');
			document.getElementById('kingPopup').style.display = 'block';
		}
		if(level==13){
			$('#words').html('You need a boat to cross the river. Trololololo lololo lololo!!');
			document.getElementById('kingPopup').style.display = 'block';
		}
		
		if(level==15){
			if(titlesbrowsed==0)
				$('#words').html('Maybe you should ask the Title God for guidance in your dire situation. May you be blessed.');
			else
				$('#words').html('I think the Title God is trolling you... eh i meant CHALLENGING you! Oh forgive me Title God! Seek some cliche methods of hiding the true answer! Our God is old fashioned');
			document.getElementById('kingPopup').style.display = 'block';
		}
	}
	
	document.getElementById('kingPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("kingPopup").style.display = 'none';
		if(level=="3") gameInfoPopup();
	});
	
	function gameInfoPopup()
	{
		moveAlow = 0;
		document.getElementById('gameInfoPopup').style.display = 'block';
	}
	
	document.getElementById('gameInfoPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("gameInfoPopup").style.display = 'none';
	});
	
	function broPopup()
	{
		moveAlow = 0;
		if(level==11){
			if(playerflipped)	$('#wordsBro').html('Please talk to my face brother!');
			else{
				if((hammer==0)&&(albcount==0)&&(brocount==0)){
					$('#wordsBro').html('O-O-omg!??! Are you my brother? Yes, yes you are! At last i found you! Listen i am in a fight with my friend Albert :(. Can you help? Here have this hammer!');
					hammer++;
					brocount++;
					$('#hammer').html('x '+ hammer);
					manageTools(0,1,"hammer");
				}
				else if((brocount==1)&&(albcount==0)){
					$('#wordsBro').html('Go now please!');
				}
				if((brocount==1)&&(albcount==1)){
					brocount++;
					$('#wordsBro').html('How do i apologise to him? I have to show sensitivity!');
				}
			}	
			document.getElementById("broPopup").style.display = 'block';
		}
	}
	
	function albPopup()
	{
		music('albert');
		moveAlow = 0;
		//LEVEL 11
		if(level==11){
			if(!playerflipped)	$('#wordsAlb').html('Talk to my face worm!');
			else {	
				if((brocount==1)&&(albcount==0)){
					$('#wordsAlb').html('Who? Who are you? You look like that insensitive bastard Robert! He said funny things about my hat!');
					albcount++;		
				}
				if((brocount==2)&&(albcount==1)&&flower){
					$('#wordsAlb').html('Flowers? What does he think i am a girl or something? Stop covering him. Take this boat and leave, this does not concern you');
					boatFlag=1;
					manageTools(1,0,"boat");
					albcount++;		
				}
				else if((brocount==2)&&(albcount==2)){
					$('#wordsAlb').html('Go now please. This world is in trouble. There will be bigger troubles in these ruins... And your brother could be the cause');
				}
			}
		}
		//LEVEL 12
		if(level==12){
			$('#wordsAlb').html("Quick! You have to call for help! I may have my differences with your brother but he's my friend and he doesn't deserve what your evil twin has done to him!");
		}
		if(level==12&&helped){
			$('#wordsAlb').html("Good now we must go! The bastard must pay!");
		}
		document.getElementById("albPopup").style.display = 'block';
	}
	
	document.getElementById('broPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("broPopup").style.display = 'none';
	});
	
	document.getElementById('albPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("albPopup").style.display = 'none';
	});

	function orderPopup()
	{
		if(level==15) $('#wordsOrd').html('Shout my name if you are to ever defeat me! Acknowledge me to stand a chance!');
		moveAlow = 0;
		document.getElementById("orderPopup").style.display = 'block';
	}
	
	document.getElementById('orderPopupExit').addEventListener('touchstart', function(e){
		moveAlow = 1;
		document.getElementById("orderPopup").style.display = 'none';
	});
	
	// Pressed Enter Manager
	function enterManager()
	{
		if 	(document.getElementById('levelUpPopup').style.display == 'block') levelup();
	}
	
	// Diaxeirisi Diastasis pinaka dynamika me tin allagi tis diastasis tou window
	
	$(window).bind("resize", function(){ 
		if (minimapVisible == true)	normalSizeMap();
		else	miniMap();
	});
		
	document.getElementById('minimap').addEventListener('touchstart', function(e) {
		if (minimapVisible == true)
		{
			minimapVisible = false;
			normalSizeMap();
			$('html, body').animate({scrollLeft: $("#Map tr:eq("+many+") td:eq("+manx+")").offset().left});
			$('html, body').animate({scrollTop: $("#Map tr:eq("+many+") td:eq("+manx+")").offset().top});	
		}
		else
		{
			minimapVisible = true;
			miniMap();
		}
	});
	
	function normalSizeMap()
	{
		var winW = $(window).width()*3;
		var winH = $(window).height()*3;
		h = Math.round(winH /n);
		$('#Grid img').css({ height: h, width: h }); 
	}
	
	function miniMap()
	{
		var winW = $(window).width();
		w = Math.ceil(winW / nv);
		$('#Grid img').css({ height: w, width: w });
	}
}



document.getElementById('minititle').addEventListener('touchstart', function(e) {
	if(level==10) {
		$('#minititle').html('Trap door is on');
		$('#Map tr:eq(0) td:eq(0)').children().attr("src",samples[8]);
	}
	
	if(level==15) {
		
		if(titlecount>5) { 
			titlecount=0; 
			titlesbrowsed=1;
		}
		if(titlecount==0)
			$('#minititle').html('His name is Zobelle');
		if(titlecount==1)
		    $('#minititle').html('Oh sorry... Right! His name is Ortan');
		if(titlecount==2)
		    $('#minititle').html('Why did i just say that? He is definetely called Dante');
		if(titlecount==3)
		    $('#minititle').html('You get i am not really helping huh? Ian it is');
		if(titlecount==4)
		    $('#minititle').html('Keep asking. He is Andrew');
		if(titlecount==5)
		    $('#minititle').html('Well i should say the truth at last. We call him Colt!');
		titlecount++;
	}
});

// Meta to login xrisimopoihte ayti i synartisi gia na emfanisei sto pinaka ta apothikeymena dedomena apo ti basi

function changeBlock(x,y,ind)
{
	if (ind != 0) $('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src",samples[ind]);	// Ama einai != 0 rinai rna apo ta samples
	else 	 $('#Map tr:eq('+y+') td:eq('+x+')').children().attr("src",images[2]);    // Ama einai 0 thelw to images[2] dld to empty
}

// Meta to login xrisimopoihte ayti i synartisi gia na bali ta swsta backround se kathe block tou Grid

function changeBackround(x,y,ind)
{
	$('#Map tr:eq('+y+') td:eq('+x+')').css("background","url("+mains[ind]+")");
	$('#Map tr:eq('+y+') td:eq('+x+')').css("backgroundSize","100% 100%");
}

//Deiaxirisi SFX

function music(from)
{
	if (!mute)
	{
		pauseAll();
		if      (from == "explore") document.getElementById("popClip").play();
		else if (from == "axe")  	document.getElementById("pickaxeClip").play();
		else if (from == "levelup") document.getElementById("levelupClip").play();
		else if (from == "chest") 	document.getElementById("chestClip").play();
		else if (from == "key") 	document.getElementById("keyClip").play();
		else if (from == "water") 	document.getElementById("waterClip").play();
		else if (from == "unlock") 	document.getElementById("unlockClip").play();
		else if (from == "albert") 	document.getElementById("albertClip").play();
		else if (from == "mirror") 	document.getElementById("mirrorClip").play();
		else if (from == "punch") 	document.getElementById("punchClip").play();
		else if (from == "ambulance") 	document.getElementById("ambulanceClip").play();
		else if (from == "antilava") 	document.getElementById("antilavaClip").play();
	}
}

function pauseAll()
{
	$.each(sounds, function(index, value) 
	{ 
		value.pause();
		if (!firefox && !ie) value.currentTime = 0;
	});
}

function playMovie() {
	
	
	if(level==12) {
	
	walk("albert",10,1);
	walk("robert",10,0);
	
	
	setTimeout(function() { 
	    		music("punch");
	    			$('#Map tr:eq('+ pos["robert"][1]+') td:eq('+ pos["robert"][0] +')').children().attr("src",samples[25]);

	},2200);
	
	setTimeout(function() { 
				pos["albert"][2]= samples[26];
				pos["bad"][2] = samples[27];
	    		walk("bad",19,1);
	    		walk("albert",6,1);
	    		
	},3000); 
	setTimeout(function() { 
	    		music("axe");
	    		breakpointy= pos["albert"][1] + 1;
	    		
	    		$('#Map tr:eq('+ breakpointy +') td:eq('+ pos["albert"][0] +')').children().attr("src",images[2]);
	    		
	    		
	},6000);  
	
	setTimeout(function() { 
	walk("albert",5,1);
	},6500);  
}
}

$('body').bind('done',function(e) { });

function walk(who,wherex,wherey) {
	
	var x = pos[who][0];
	var y = pos[who][1];
	var ytogo = y;
	var xtogo;
	if(wherex>x)
	xtogo = x+1;
	else xtogo=x-1;

	$('#Map tr:eq('+ ytogo +') td:eq('+ xtogo +')').children().attr("src",pos[who][2]);
	$('#Map tr:eq('+ y +') td:eq('+ x +')').children().attr("src",images[2]);
	setTimeout(function() {
		
		if(xtogo>x)
		pos[who][0]++;
		else pos[who][0]--;
		if(xtogo != wherex) walk(who,wherex,wherey);
		else $('body').trigger('done');
	},500);
	
	
}

function doOrder() {
	
	if(level==12) {
		if($('#order').val()=='HELP') {
			moveAlow=1;
			document.getElementById('orderPopup').style.display = 'none';
			moveAlow=0;
			$('#Map tr:eq(5) td:eq(18)').children().attr("src",samples[28]);
			music("ambulance");
			walk("ambulance",10,5);
			setTimeout(function() { 
		    	walk("ambulance",19,5);
			},6000);
			setTimeout(function() { 
		    	moveAlow=1;
		    	document.getElementById("ambulanceClip").play();
			},8000);
			helped=1;
		}
		else {
			moveAlow=1;
			document.getElementById('orderPopup').style.display = 'none';
		}
	}
	
	if(level==15) {
		if($('#order').val()=='ZODIAC') {
			moveAlow=1;
			document.getElementById('orderPopup').style.display = 'none';
			$('#Map tr:eq(1) td:eq(2) img').attr("src",samples[5]);
			$('#Map tr:eq(3) td:eq(2) img').attr("src",samples[5]);
			$('#Map tr:eq(5) td:eq(2) img').attr("src",samples[5]);
			$('#Map tr:eq(1) td:eq(2) img').draggable({revert:true});
			$('#Map tr:eq(3) td:eq(2) img').draggable({revert:true});
			$('#Map tr:eq(5) td:eq(2) img').draggable({revert:true});
			$( "#Map tr:eq(4) td:eq(18)" ).droppable({
				drop: function( event, ui ) {
					ui.draggable.hide("explode", 1000);  
					music("axe");
					badWormEnergy--;
					if(badWormEnergy==0){
						$( "#Map tr:eq(4) td:eq(18) img" ).fadeOut("slow",function(){
			    		   	$('#Map tr:eq(4) td:eq(18)').children().attr("src",samples[30]);
			    		   	$('#Map tr:eq(4) td:eq(18)').children().fadeIn("fast");
		    		   	});
					}
		   		}
		   	});
		}
	}
}

function gameInfoPopup()
{
	moveAlow = 0;
	document.getElementById('gameInfoPopup').style.display = 'block';
}

</script>
</body>
</html>